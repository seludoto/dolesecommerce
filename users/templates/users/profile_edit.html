{% extends 'base.html' %}
{% load static %}

{% block content %}
{% load i18n %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card shadow border-0" style="border-radius: 20px;">
        <div class="card-header bg-transparent border-0 text-center pt-4">
          <img src="{% static 'images/paper-boat.png.jpg' %}" alt="Paper Boat Logo" style="height:60px;">
          <h4 class="mt-3 mb-0"><i class="fas fa-user-edit me-2 text-primary"></i>{% trans "Edit Profile" %}</h4>
          <p class="text-muted">{% trans "Update your profile information" %}</p>
        </div>
        <div class="card-body p-4">
          {% if messages %}
            {% for message in messages %}
              <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
              </div>
            {% endfor %}
          {% endif %}

          <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <!-- Avatar Section -->
            <div class="text-center mb-4">
              <div class="position-relative d-inline-block">
                {% if profile.avatar %}
                  <img src="{{ profile.avatar.url }}" alt="Avatar" 
                       class="rounded-circle shadow" id="avatar-preview"
                       style="width: 120px; height: 120px; object-fit: cover;">
                {% else %}
                  <img src="{% static 'images/default-avatar.png' %}" alt="Default Avatar" 
                       class="rounded-circle shadow" id="avatar-preview"
                       style="width: 120px; height: 120px; object-fit: cover;">
                {% endif %}
                <label for="id_avatar" class="position-absolute bottom-0 end-0 bg-primary text-white rounded-circle p-2 cursor-pointer" style="cursor: pointer;">
                  <i class="fas fa-camera"></i>
                </label>
              </div>
              <input type="file" class="d-none" id="id_avatar" name="avatar" accept="image/*" onchange="previewAvatar(this)">
              <div class="mt-2">
                <small class="text-muted">{% trans "Click the camera icon to change your profile picture" %}</small>
              </div>
            </div>

            <div class="row">
              <!-- Personal Information -->
              <div class="col-md-6 mb-3 d-flex flex-column justify-content-start align-items-stretch">
                <label for="id_first_name" class="form-label fw-bold text-start w-100">
                  <i class="fas fa-user me-2 text-primary"></i>{% trans "First Name" %}
                </label>
                <input type="text" class="form-control w-100" id="id_first_name" name="first_name" 
                       value="{{ user.first_name }}" style="border-radius: 10px;" placeholder="Enter your first name">
              </div>
              
              <div class="col-md-6 mb-3 d-flex flex-column justify-content-start align-items-stretch">
                <label for="id_last_name" class="form-label fw-bold text-start w-100">
                  <i class="fas fa-user me-2 text-primary"></i>{% trans "Last Name" %}
                </label>
                <input type="text" class="form-control w-100" id="id_last_name" name="last_name" 
                       value="{{ user.last_name }}" style="border-radius: 10px;" placeholder="Enter your last name">
              </div>
              
              <div class="col-md-6 mb-3 d-flex flex-column justify-content-start align-items-stretch">
                <label for="id_email" class="form-label fw-bold text-start w-100">
                  <i class="fas fa-envelope me-2 text-primary"></i>{% trans "Email Address" %}
                </label>
                <input type="email" class="form-control w-100" id="id_email" name="email" 
                       value="{{ user.email }}" style="border-radius: 10px;" placeholder="your@email.com">
              </div>
              
              <div class="col-md-6 mb-3 d-flex flex-column justify-content-start align-items-stretch">
                <label for="id_username" class="form-label fw-bold text-start w-100">
                  <i class="fas fa-at me-2 text-primary"></i>{% trans "Username" %}
                </label>
                <input type="text" class="form-control w-100" id="id_username" name="username" 
                       value="{{ user.username }}" style="border-radius: 10px;" placeholder="Choose a username">
              </div>
              
              <div class="col-md-6 mb-3 d-flex flex-column justify-content-start align-items-stretch">
                <label for="id_phone" class="form-label fw-bold text-start w-100">
                  <i class="fas fa-phone me-2 text-primary"></i>{% trans "Phone Number" %}
                </label>
                <input type="text" class="form-control w-100" id="id_phone" name="phone" 
                       value="{{ profile.phone }}" style="border-radius: 10px;" placeholder="+1234567890">
              </div>
              
              <div class="col-md-6 mb-3 d-flex flex-column justify-content-start align-items-stretch">
                <label for="id_country" class="form-label fw-bold text-start w-100">
                  <i class="fas fa-globe me-2 text-primary"></i>{% trans "Country" %}
                </label>
                <select class="form-control w-100" id="id_country" name="country" style="border-radius: 10px;">
                  <option value="">Select your country</option>
                  <option value="Kenya" {% if profile.country == 'Kenya' %}selected{% endif %}>Kenya</option>
                  <option value="Nigeria" {% if profile.country == 'Nigeria' %}selected{% endif %}>Nigeria</option>
                  <option value="South Africa" {% if profile.country == 'South Africa' %}selected{% endif %}>South Africa</option>
                  <option value="United States" {% if profile.country == 'United States' %}selected{% endif %}>United States</option>
                  <option value="United Kingdom" {% if profile.country == 'United Kingdom' %}selected{% endif %}>United Kingdom</option>
                  <option value="India" {% if profile.country == 'India' %}selected{% endif %}>India</option>
                  <option value="Canada" {% if profile.country == 'Canada' %}selected{% endif %}>Canada</option>
                  <option value="Germany" {% if profile.country == 'Germany' %}selected{% endif %}>Germany</option>
                  <option value="France" {% if profile.country == 'France' %}selected{% endif %}>France</option>
                  <option value="China" {% if profile.country == 'China' %}selected{% endif %}>China</option>
                  <option value="Japan" {% if profile.country == 'Japan' %}selected{% endif %}>Japan</option>
                  <option value="Australia" {% if profile.country == 'Australia' %}selected{% endif %}>Australia</option>
                  <option value="South Sudan" {% if profile.country == 'South Sudan' %}selected{% endif %}>South Sudan</option>
                  <option value="Uganda" {% if profile.country == 'Uganda' %}selected{% endif %}>Uganda</option>
                  <option value="Tanzania" {% if profile.country == 'Tanzania' %}selected{% endif %}>Tanzania</option>
                  <option value="Rwanda" {% if profile.country == 'Rwanda' %}selected{% endif %}>Rwanda</option>
                  <option value="Ethiopia" {% if profile.country == 'Ethiopia' %}selected{% endif %}>Ethiopia</option>
                  <option value="Ghana" {% if profile.country == 'Ghana' %}selected{% endif %}>Ghana</option>
                  <option value="Other" {% if profile.country == 'Other' %}selected{% endif %}>Other</option>
                </select>
              </div>
              
              <div class="col-12 mb-3 d-flex flex-column justify-content-start align-items-stretch">
                <label for="id_address" class="form-label fw-bold text-start w-100">
                  <i class="fas fa-map-marker-alt me-2 text-primary"></i>{% trans "Address" %}
                </label>
                <textarea class="form-control w-100" id="id_address" name="address" rows="3" 
                          style="border-radius: 10px;" placeholder="Enter your full address">{{ profile.address }}</textarea>
              </div>
              
              <div class="col-12 mb-3 d-flex flex-column justify-content-start align-items-stretch">
                <label for="id_bio" class="form-label fw-bold text-start w-100">
                  <i class="fas fa-quote-left me-2 text-primary"></i>{% trans "Bio" %}
                </label>
                <textarea class="form-control w-100" id="id_bio" name="bio" rows="3" 
                          style="border-radius: 10px;" placeholder="Tell us about yourself...">{{ profile.bio }}</textarea>
                <small class="text-muted">{% trans "Maximum 200 characters" %}</small>
              </div>
              
              <div class="col-12 mb-4 d-flex flex-column justify-content-start align-items-stretch">
                <label for="id_website" class="form-label fw-bold text-start w-100">
                  <i class="fas fa-link me-2 text-primary"></i>{% trans "Website" %}
                </label>
                <input type="url" class="form-control w-100" id="id_website" name="website" 
                       value="{{ profile.website }}" style="border-radius: 10px;" placeholder="https://yourwebsite.com">
              </div>
            </div>
            
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
              <a href="{% url 'users:profile' %}" class="btn btn-outline-secondary me-md-2" style="border-radius: 10px;">
                <i class="fas fa-times me-2"></i>{% trans "Cancel" %}
              </a>
              <button type="submit" class="btn btn-primary" style="border-radius: 10px;">
                <i class="fas fa-save me-2"></i>{% trans "Save Changes" %}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function previewAvatar(input) {
  if (input.files && input.files[0]) {
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById('avatar-preview').src = e.target.result;
    };
    reader.readAsDataURL(input.files[0]);
  }
}

// Character counter for bio
document.getElementById('id_bio').addEventListener('input', function() {
  const maxLength = 200;
  const currentLength = this.value.length;
  const remaining = maxLength - currentLength;
  
  // Update counter or add one if it doesn't exist
  let counter = document.getElementById('bio-counter');
  if (!counter) {
    counter = document.createElement('small');
    counter.id = 'bio-counter';
    counter.className = 'text-muted';
    this.parentNode.appendChild(counter);
  }
  
  counter.textContent = `${currentLength}/${maxLength} characters`;
  if (remaining < 20) {
    counter.className = 'text-warning';
  } else if (remaining < 0) {
    counter.className = 'text-danger';
  } else {
    counter.className = 'text-muted';
  }
});
</script>

{% endblock %}
