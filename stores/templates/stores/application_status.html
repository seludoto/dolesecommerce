{% extends 'base.html' %}
{% load static %}

{% block title %}Application Status - {{ block.super }}{% endblock %}

{% block extra_css %}
<style>
    .application-card {
        background: white;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        margin-bottom: 30px;
    }
    
    .status-badge {
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 0.5px;
    }
    
    .status-pending {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
    }
    
    .status-under_review {
        background: #cce5ff;
        color: #004085;
        border: 1px solid #99d6ff;
    }
    
    .status-approved {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }
    
    .status-rejected {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }
    
    .timeline {
        position: relative;
        padding: 20px 0;
    }
    
    .timeline-item {
        position: relative;
        padding-left: 40px;
        margin-bottom: 20px;
    }
    
    .timeline-item::before {
        content: '';
        position: absolute;
        left: 8px;
        top: 8px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #28a745;
    }
    
    .timeline-item.pending::before {
        background: #ffc107;
    }
    
    .timeline-item.current::before {
        background: #007bff;
        box-shadow: 0 0 0 4px rgba(0,123,255,0.2);
    }
    
    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 25px 0;
    }
    
    .info-item {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #007bff;
    }
    
    .info-label {
        font-weight: 600;
        color: #666;
        font-size: 0.9rem;
        margin-bottom: 5px;
    }
    
    .info-value {
        color: #333;
        font-size: 1rem;
    }
    
    .documents-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
    }
    
    .document-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid #e9ecef;
    }
    
    .document-item:last-child {
        border-bottom: none;
    }
    
    .document-icon {
        color: #28a745;
        margin-right: 10px;
    }
    
    .action-buttons {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        margin-top: 25px;
    }
    
    .btn {
        padding: 10px 20px;
        border-radius: 6px;
        font-weight: 500;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }
    
    .progress-indicator {
        background: #e9ecef;
        height: 6px;
        border-radius: 3px;
        margin: 20px 0;
        overflow: hidden;
    }
    
    .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #007bff, #28a745);
        border-radius: 3px;
        transition: width 0.3s ease;
    }
    
    .progress-pending {
        width: 25%;
    }
    
    .progress-under_review {
        width: 50%;
    }
    
    .progress-approved {
        width: 100%;
    }
    
    .progress-rejected {
        width: 100%;
        background: linear-gradient(90deg, #dc3545, #dc3545);
    }
    
    .status-icon {
        font-size: 2.5rem;
        margin-bottom: 15px;
    }
    
    .rejection-notice {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        border-radius: 8px;
        padding: 20px;
        margin: 20px 0;
        color: #721c24;
    }
    
    .admin-notes {
        background: #e3f2fd;
        border: 1px solid #bbdefb;
        border-radius: 8px;
        padding: 20px;
        margin: 20px 0;
        color: #1565c0;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="application-card">
                <!-- Header Section -->
                <div class="text-center mb-4">
                    {% if application.status == 'pending' %}
                        <i class="fas fa-clock status-icon text-warning"></i>
                        <h2>Application Under Review</h2>
                        <p class="text-muted">We're reviewing your store application</p>
                    {% elif application.status == 'under_review' %}
                        <i class="fas fa-search status-icon text-info"></i>
                        <h2>Application Under Review</h2>
                        <p class="text-muted">Our team is carefully reviewing your application</p>
                    {% elif application.status == 'approved' %}
                        <i class="fas fa-check-circle status-icon text-success"></i>
                        <h2>Congratulations!</h2>
                        <p class="text-muted">Your store application has been approved</p>
                    {% elif application.status == 'rejected' %}
                        <i class="fas fa-times-circle status-icon text-danger"></i>
                        <h2>Application Declined</h2>
                        <p class="text-muted">Unfortunately, your application was not approved</p>
                    {% endif %}
                </div>

                <!-- Status Badge -->
                <div class="text-center mb-4">
                    <span class="status-badge status-{{ application.status }}">
                        {{ application.get_status_display }}
                    </span>
                </div>

                <!-- Progress Indicator -->
                <div class="progress-indicator">
                    <div class="progress-bar progress-{{ application.status }}"></div>
                </div>

                <!-- Application Details -->
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Store Name</div>
                        <div class="info-value">{{ application.store_name }}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Business Type</div>
                        <div class="info-value">{{ application.get_business_type_display }}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Contact Email</div>
                        <div class="info-value">{{ application.contact_email }}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Contact Phone</div>
                        <div class="info-value">{{ application.contact_phone }}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Submitted Date</div>
                        <div class="info-value">{{ application.submitted_at|date:"F d, Y" }}</div>
                    </div>
                    {% if application.reviewed_at %}
                    <div class="info-item">
                        <div class="info-label">Review Date</div>
                        <div class="info-value">{{ application.reviewed_at|date:"F d, Y" }}</div>
                    </div>
                    {% endif %}
                </div>

                <!-- Store Description -->
                <div class="info-item" style="grid-column: 1 / -1;">
                    <div class="info-label">Store Description</div>
                    <div class="info-value">{{ application.store_description }}</div>
                </div>

                <!-- Business Address -->
                <div class="info-item" style="grid-column: 1 / -1;">
                    <div class="info-label">Business Address</div>
                    <div class="info-value">{{ application.business_address }}</div>
                </div>

                <!-- Documents Section -->
                {% if application.license_document or application.tax_document or application.identity_document %}
                <div class="documents-section">
                    <h5><i class="fas fa-file-alt"></i> Submitted Documents</h5>
                    {% if application.license_document %}
                    <div class="document-item">
                        <div>
                            <i class="fas fa-file-contract document-icon"></i>
                            Business License
                        </div>
                        <a href="{{ application.license_document.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-download"></i> View
                        </a>
                    </div>
                    {% endif %}
                    
                    {% if application.tax_document %}
                    <div class="document-item">
                        <div>
                            <i class="fas fa-receipt document-icon"></i>
                            Tax Document
                        </div>
                        <a href="{{ application.tax_document.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-download"></i> View
                        </a>
                    </div>
                    {% endif %}
                    
                    {% if application.identity_document %}
                    <div class="document-item">
                        <div>
                            <i class="fas fa-id-card document-icon"></i>
                            Identity Document
                        </div>
                        <a href="{{ application.identity_document.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-download"></i> View
                        </a>
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                <!-- Admin Notes -->
                {% if application.admin_notes %}
                <div class="admin-notes">
                    <h6><i class="fas fa-sticky-note"></i> Admin Notes</h6>
                    <p class="mb-0">{{ application.admin_notes }}</p>
                </div>
                {% endif %}

                <!-- Rejection Reason -->
                {% if application.status == 'rejected' and application.rejection_reason %}
                <div class="rejection-notice">
                    <h6><i class="fas fa-exclamation-triangle"></i> Rejection Reason</h6>
                    <p class="mb-0">{{ application.rejection_reason }}</p>
                </div>
                {% endif %}

                <!-- Timeline -->
                <div class="timeline">
                    <h5 class="mb-3"><i class="fas fa-history"></i> Application Timeline</h5>
                    
                    <div class="timeline-item">
                        <strong>Application Submitted</strong>
                        <div class="text-muted">{{ application.submitted_at|date:"F d, Y \a\t g:i A" }}</div>
                    </div>
                    
                    {% if application.status != 'pending' %}
                    <div class="timeline-item {% if application.status == 'under_review' %}current{% endif %}">
                        <strong>Under Review</strong>
                        <div class="text-muted">Application is being reviewed by our team</div>
                    </div>
                    {% endif %}
                    
                    {% if application.status == 'approved' %}
                    <div class="timeline-item current">
                        <strong>Application Approved</strong>
                        <div class="text-muted">{{ application.reviewed_at|date:"F d, Y \a\t g:i A" }}</div>
                    </div>
                    {% elif application.status == 'rejected' %}
                    <div class="timeline-item current">
                        <strong>Application Declined</strong>
                        <div class="text-muted">{{ application.reviewed_at|date:"F d, Y \a\t g:i A" }}</div>
                    </div>
                    {% endif %}
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    {% if application.status == 'approved' %}
                        <a href="{% url 'stores:seller_dashboard' %}" class="btn btn-success">
                            <i class="fas fa-store"></i> Go to Seller Dashboard
                        </a>
                    {% elif application.status == 'rejected' %}
                        <a href="{% url 'stores:apply_for_store' %}" class="btn btn-primary">
                            <i class="fas fa-redo"></i> Submit New Application
                        </a>
                    {% endif %}
                    
                    <a href="{% url 'core:home' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-home"></i> Back to Home
                    </a>
                </div>

                <!-- Help Section -->
                <div class="mt-4 p-3 bg-light rounded">
                    <h6><i class="fas fa-question-circle"></i> Need Help?</h6>
                    <p class="mb-2">If you have any questions about your application or the review process:</p>
                    <ul class="mb-0">
                        <li>Email us at support@example.com</li>
                        <li>Call our support line: +1 (555) 123-4567</li>
                        <li>Check our <a href="#">Seller Guidelines</a> for more information</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Add smooth animations
    $('.application-card').hide().fadeIn(500);
    
    // Auto-refresh for pending applications (every 30 seconds)
    const appStatus = '{{ application.status }}';
    if (appStatus === 'pending' || appStatus === 'under_review') {
        let refreshInterval = setInterval(function() {
            // Check if user is still on the page
            if (document.visibilityState === 'visible') {
                // Show a subtle indication that we're checking for updates
                $('.status-badge').addClass('animate__animated animate__pulse');
                
                // You could add AJAX refresh logic here if needed
                setTimeout(function() {
                    $('.status-badge').removeClass('animate__animated animate__pulse');
                }, 2000);
            }
        }, 30000);
        
        // Clear interval when leaving page
        $(window).on('beforeunload', function() {
            clearInterval(refreshInterval);
        });
    }
    
    // Smooth scroll to important sections
    $('a[href^="#"]').on('click', function(e) {
        e.preventDefault();
        const target = $($(this).attr('href'));
        if (target.length) {
            $('html, body').animate({
                scrollTop: target.offset().top - 100
            }, 500);
        }
    });
});
</script>
{% endblock %}
